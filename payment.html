<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout | Stream Africa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap');
        
        :root { 
            --stream-green: #b8d5b0; 
            --stream-dark: #0a1f1c; 
        }

        body {
            background-color: var(--stream-dark);
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(184, 213, 176, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 100% 100%, rgba(184, 213, 176, 0.05) 0%, transparent 40%);
            color: #fff; 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            min-height: 100vh; 
            padding-bottom: 50px;
            overflow-x: hidden;
        }

        .checkout-container { max-width: 450px; margin: 0 auto; padding: 20px; }
        
        .premium-card { 
            background: rgba(255, 255, 255, 0.03); 
            backdrop-filter: blur(20px); 
            border: 2px solid var(--stream-green); 
            border-radius: 32px; 
            padding: 30px 24px; 
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); 
        }
        
        .timer-badge { 
            background: rgba(231, 76, 60, 0.1); 
            border: 1px solid rgba(231, 76, 60, 0.2); 
            color: #ff6b6b; 
            padding: 6px 14px; 
            border-radius: 100px; 
            font-weight: 700; 
            font-size: 13px; 
            display: inline-flex; 
            align-items: center; 
            gap: 6px; 
        }
        
        .amount-box { 
            background: rgba(184, 213, 176, 0.1); 
            border-radius: 20px; 
            padding: 20px; 
            text-align: center;
            margin: 25px 0; 
            border: 1px solid rgba(184, 213, 176, 0.2); 
        }
        .amount-box span { display: block; font-size: 10px; color: rgba(255,255,255,0.5); text-transform: uppercase; font-weight: 800; margin-bottom: 5px; }
        .amount-box div { font-size: 28px; font-weight: 900; color: #ffffff; }
        
        .bank-details-wrapper { 
            background: rgba(255,255,255,0.02); 
            border: 1px dashed rgba(184, 213, 176, 0.4); 
            border-radius: 24px; 
            padding: 24px; 
            margin: 25px 0; 
            cursor: pointer; 
            position: relative; 
            transition: all 0.3s;
        }
        .bank-details-wrapper:active { background: rgba(184, 213, 176, 0.05); }
        
        .account-number-text { font-size: 26px; font-weight: 900; letter-spacing: 1px; color: var(--stream-green); margin: 6px 0; word-break: break-all; }
        
        .btn-main { 
            background: var(--stream-green); 
            color: var(--stream-dark); 
            width: 100%; 
            padding: 20px; 
            border-radius: 20px; 
            font-weight: 900; 
            font-size: 16px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 12px; 
            transition: all 0.3s; 
            text-transform: uppercase;
        }
        .btn-main:active { transform: scale(0.96); }

        #overlay { position: fixed; inset: 0; background: rgba(10, 31, 28, 0.98); display: none; align-items: center; justify-content: center; flex-direction: column; z-index: 9999; backdrop-filter: blur(10px); }
        .loader-ring { width: 60px; height: 60px; border: 4px solid rgba(184, 213, 176, 0.1); border-top: 4px solid var(--stream-green); border-radius: 50%; animation: spin 0.8s linear infinite; }
        
        @keyframes spin { 100% { transform: rotate(360deg); } }

        .activity-popup { 
            position: fixed; top: 15px; left: 15px; 
            background: var(--stream-dark); 
            border: 2px solid var(--stream-green); 
            border-radius: 14px; padding: 10px 14px; 
            display: flex; align-items: center; gap: 12px; 
            transform: translateX(-130%); transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1); 
            z-index: 1000; min-width: 250px; 
        }
        .activity-popup.show { transform: translateX(0); }
        .activity-icon { color: var(--stream-green); font-size: 18px; }
    </style>
</head>
<body>

<div id="activity-popup" class="activity-popup">
    <div id="activity-icon" class="activity-icon"><i class="fas fa-circle-check"></i></div>
    <div class="flex-1 overflow-hidden">
        <p id="activity-text" class="text-[11px] font-extrabold text-white mb-0.5"></p>
        <p id="activity-sub" class="text-[9px] text-white/50"></p>
    </div>
</div>

<div class="checkout-container">
    <div class="flex flex-col justify-center items-center gap-2 py-8">
        <h1 class="text-xl font-black text-white/40 tracking-[0.3em] uppercase">STREAM AFRICA</h1>
    </div>

    <div class="premium-card">
        <div class="text-center">
            <div class="timer-badge">
                <i class="fas fa-clock text-[11px]"></i> 
                <span id="timer" class="font-mono">10:00</span>
            </div>
            
            <h2 class="text-2xl font-black mt-6 mb-2 uppercase tracking-tight">Activation</h2>
            <p class="text-white/50 text-[11px] leading-relaxed px-4">
                Complete your registration by making the required payment to the <span id="country-name-label" class="text-white font-bold">...</span> secure gateway.
            </p>
        </div>

        <div class="amount-box">
            <span>Registration Fee</span>
            <div id="display-amount">...</div>
        </div>

        <div class="bank-details-wrapper" onclick="copyNum()">
            <div class="flex items-center gap-2 text-[#b8d5b0] text-[10px] font-black tracking-widest uppercase mb-6">
                <i class="fas fa-shield-check"></i> Verified Merchant
            </div>
            
            <div class="mb-5">
                <p class="text-[9px] text-white/30 uppercase font-black tracking-wider mb-1">Bank / Method</p>
                <p id="bank-name-display" class="text-lg font-bold tracking-tight">...</p>
            </div>

            <div class="mb-5">
                <p class="text-[9px] text-white/30 uppercase font-black tracking-wider mb-1">Account Number</p>
                <p id="db-number" class="account-number-text">...</p>
                <span class="text-[8px] bg-white/10 text-white/50 px-2 py-1 rounded font-black uppercase">Click to copy</span>
            </div>

            <div>
                <p class="text-[9px] text-white/30 uppercase font-black tracking-wider mb-1">Account Name</p>
                <p id="account-name-display" class="text-[13px] font-bold leading-tight uppercase text-white/80">...</p>
            </div>
        </div>

        <button onclick="confirmPayment()" class="btn-main">
            I Have Made Payment <i class="fas fa-arrow-right ml-1"></i>
        </button>

        <p class="text-[9px] text-center mt-4 text-white/30 italic">Note: Use "Immediate Transaction" to ensure instant processing.</p>

        <div class="mt-8 flex justify-center items-center gap-6 opacity-20">
            <i class="fas fa-lock text-lg"></i>
            <span class="text-[10px] font-bold uppercase tracking-widest">End-to-End Encrypted</span>
        </div>
    </div>
</div>

<div id="overlay">
    <div class="loader-ring"></div>
    <h3 class="mt-8 text-xl font-black text-[#b8d5b0] uppercase tracking-widest">Verifying</h3>
    <p class="text-white/40 text-xs mt-3 font-bold uppercase tracking-widest">Syncing with Stream Network...</p>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAyMQQK0qbw1lpeuPcPmFgSpBoy1yFKFJE",
        authDomain: "celeste-website.firebaseapp.com",
        projectId: "celeste-website",
        storageBucket: "celeste-website.firebasestorage.app",
        messagingSenderId: "181088900219",
        appId: "1:181088900219:web:eb1fedd04dc0cf676b7ede"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    
    // CRITICAL: This path must match the Admin Dashboard exactly
    const docPath = "configs/celeste-main/data/main";

    const streamData = {
        "uganda": { name: "Uganda", bank: "AIRTEL UGANDA", number: "0751129095", holder: "LILIAN NAMATOVU", amount: "65,000 UGX" },
        "south_africa": { name: "South Africa", bank: "FNB", number: "63096232756", holder: "Tegha digital (pty)Ltd", amount: "350 ZAR" },
        "nigeria": { name: "Nigeria", bank: "KUDA", number: "3003451314", holder: "BERRY IBEREDEM ENTERPRISE", amount: "â‚¦12,000" },
        "ghana": { name: "Ghana", bank: "MTN", number: "0550827063", holder: "RUTH ENNIN", amount: "200 GHS" },
        "cameroon": { name: "Cameroon", bank: "MTN", number: "652856398", holder: "BELTUS EBOB", amount: "12,000 XAF" },
        "kenya": { name: "Kenya", bank: "AIRTEL MONEY", number: "0107494918", holder: "MOHAMED HADID", amount: "2,500 KES" }
    };

    let vendorLink = "https://t.me/STREAM_OFFICIAL2";

    function setupUI() {
        const selected = localStorage.getItem('selected_country') || 'nigeria';
        const data = streamData[selected];
        if (data) {
            document.getElementById('country-name-label').innerText = data.name;
            document.getElementById('bank-name-display').innerText = data.bank;
            document.getElementById('db-number').innerText = data.number;
            document.getElementById('account-name-display').innerText = data.holder;
            document.getElementById('display-amount').innerText = data.amount;
        }
    }

    async function initPage() {
        setupUI();
        try {
            await signInAnonymously(auth);
            // Listen to the cloud for changes
            onSnapshot(doc(db, docPath), (snap) => {
                if(snap.exists()) {
                    const d = snap.data();
                    if(d.telegramLink) vendorLink = d.telegramLink;
                    
                    const selected = localStorage.getItem('selected_country') || 'nigeria';
                    // If Nigeria is selected, override static data with Cloud data
                    if(selected === 'nigeria') {
                        if(d.nigeriaBank) document.getElementById('bank-name-display').innerText = d.nigeriaBank;
                        if(d.nigeriaNumber) document.getElementById('db-number').innerText = d.nigeriaNumber;
                        if(d.nigeriaHolder) document.getElementById('account-name-display').innerText = d.nigeriaHolder;
                        if(d.nigeriaAmount) document.getElementById('display-amount').innerText = d.nigeriaAmount;
                    }
                }
            });
        } catch(e) { console.error("Cloud Error:", e); }
    }

    window.onload = initPage;
    // ... rest of your functions (copyNum, confirmPayment, timer, activity) remain same
</script>
</body>
</html>
